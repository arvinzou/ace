function pizzaLog(t){pizzaConfig.debug&&("object"==typeof t&&(t=JSON.stringify(t)),console.log(t))}var pizzaConfig={path:$("script").last().attr("src").split("/js/")[0],debug:!1,version:"1.1.4",timestamp:+new Date};"localhost"!=location.hostname&&"127.0.0.1"!=location.hostname||(pizzaConfig.debug=!0);var pizzaTpl={},pizzaCmd={};pizzaCmd.tpl=function(t,i){var e=pizzaConfig.path+"/tpl/"+t;0==$("#j-tplFrame").length&&$("body").append('<div class="fn-hide"><iframe id="j-tplFrame" src="about:blank"></iframe></div>');var s="tplCallback"+(new Date).getTime();window[s]=function(t){$.each(t,function(t,i){pizzaTpl[t]=i}),i()},$("#j-tplFrame").attr("src",e+"?callback="+s)},pizzaCmd.layout=function(t,i){$("body > div").remove(),pizzaCmd.tpl("layout.html",function(){function e(t,i){i||(i=0),$(".j-headerItem").removeClass("current");var e=$(".j-headerItem").eq(t);e.addClass("current"),pizzaCmd.history.clear(),pizzaCmd.history.push(e.data("title"),null),$("#j-sideNav ul").css("display","none");var s=$("#j-sideNav ul").eq(t);if(s.css("display","block"),s.find("li").removeClass("current"),s.find("li").length){var o=s.find("li").eq(i);o.addClass("current"),pizzaCmd.history.push(o.data("title"),o.data("link"))}}$("body").append(juicer(pizzaTpl.pzHeader,t)),$("body").append(juicer(pizzaTpl.pzSide,t)),$("body").append(pizzaTpl.pzMain),e(0),$(".j-headerItem").each(function(t){$(this).data("index",t)}),$("#j-headerNav span").click(function(){e($(this).data("index"))}),$("#j-headerOther .j-headerItem").each(function(){var t=$(this).data("index");$(this).find(".j-optionlink").length?$(this).find(".j-optionlink").each(function(i){$(this).click(function(){e(t,i)})}):$(this).click(function(){e(t),pizzaCmd.history.clear(),pizzaCmd.history.push($(this).data("title"),$(this).data("link"))})}),$("#j-sideNav li").click(function(){$("#j-sideNav li").removeClass("current"),$(this).addClass("current"),pizzaCmd.history.clear(1),pizzaCmd.history.push($(this).data("title"),$(this).data("link"))}),i&&i()})},pizzaCmd.login=function(t,i){$("body > div").remove(),pizzaCmd.tpl("login.html",function(){$("body").append(juicer(pizzaTpl.pzLogin,t)),i&&i()})},pizzaCmd.history={list:[],iframeList:[],push:function(t,i){var e=pizzaCmd.history;e.list.push({title:t,link:i});var s=e.list.length-1;if(!e.iframeList[s]){var o=$('<iframe frameborder="0" scrolling="auto" name="mainIframe'+s+'" src="about:blank"></iframe>');e.iframeList.push(o),$("#j-mainIframe").append(o)}i&&(i.indexOf("?")<0&&(i+="?"),i+="&_t="+pizzaConfig.timestamp,e.iframeList[s].attr("src",i)),e.show()},replace:function(t,i){var e=pizzaCmd.history,s=e.list.length;s&&e.list.pop(),e.push(t,i)},pop:function(){pizzaCmd.history.clear(pizzaCmd.history.list.length-1)},clear:function(t){var i=pizzaCmd.history;t||(t=0);var e=[];if(t>0)for(var s=0;s<t;s++)e.push(i.list[s]);i.list=e;for(var s=t;s<i.iframeList.length;s++)i.iframeList[s].attr("src","about:blank");i.show()},show:function(){for(var t=pizzaCmd.history,i=0;i<t.iframeList.length;i++)t.iframeList[i].css("display","none");t.list.length&&t.iframeList[t.list.length-1].css("display","block"),$("#j-breadcrumb").html(""),$.each(t.list,function(i){0==i?$("#j-breadcrumb").append('<em class="pz-icon icon-all"></em>'):$("#j-breadcrumb").append('<em class="pz-icon icon-more"></em>');var e=$('<span data-index="'+i+'">'+this.title+"</span>");this.link&&(e.addClass("pointer"),e.click(function(){t.clear(+$(this).data("index")+1)})),$("#j-breadcrumb").append(e)})},refresh:function(t){t||(t=0);var i=pizzaCmd.history,e=i.list.length,s=i.iframeList[e-1+t];s&&s[0].contentWindow.location.reload()}},pizzaCmd.checkall=function(t,i){"object"!=typeof t&&(t=$("#"+t)),t.find("input[type=checkbox]").each(function(){this.checked=i})},pizzaCmd.dragorder=function(t,i){"object"!=typeof t?this.obj=$("#"+t):this.obj=t,i?this.startIndex=i:this.startIndex=0,this.objArray=[],this.init()},pizzaCmd.dragorder.prototype={init:function(){var t=this;this.obj.find("tr").each(function(i){i>=t.startIndex&&(this.ondragstart=function(t){t.dataTransfer.setData("Text",$(this).data("dragstart"))},this.ondragend=function(i){t.obj.find("tr").removeClass("dragover")},this.ondragover=function(i){i.preventDefault(),t.obj.find("tr").removeClass("dragover"),$(this).addClass("dragover")},this.ondrop=function(i){i.preventDefault(),t.obj.find("tr").removeClass("dragover");var e=i.dataTransfer.getData("Text"),s=t.objArray[e],o=s.data("dragend"),a=$(this).data("dragend");o<a?$(this).after(s):o>a&&$(this).before(s),t.obj.find("tr").each(function(i){i>=t.startIndex&&$(this).data("dragend",i)})})})},start:function(){var t=this;t.objArray=[],this.obj.find("tr").each(function(i){t.objArray.push($(this)),i>=t.startIndex&&$(this).attr("draggable","true").addClass("draggable").data("dragstart",i).data("dragend",i)})},end:function(){var t=this,i=[];return this.obj.find("tr").each(function(e){if(e>=t.startIndex){$(this).attr("draggable","false").removeClass("draggable");var s=$(this).data("dragstart"),o=$(this).data("dragend");i.push({obj:$(this),startIndex:s,endIndex:o,diffIndex:s-o})}}),i}},pizzaCmd.page=function(t,i){var e={count:null,totalPage:null,page:1,pageSize:null,loadCallback:null,callback:null};if($.extend(e,i),null==e.totalPage){if(null==e.count)return!1;null==e.pageSize&&(e.pageSize=20),e.totalPage=Math.ceil(e.count/e.pageSize)}if(e.totalPage){"object"!=typeof t&&(t=$("#"+t));var s="";if(e.page>1?(s+='<span class="page-first" data-page="1"><i class="pz-icon icon-first"></i>首页</span>',s+='<span data-page="'+(e.page-1)+'"><i class="pz-icon icon-back"></i>上一页</span>'):(s+='<span class="page-first page-disabled"><i class="pz-icon icon-first"></i>首页</span>',s+='<span class="page-disabled"><i class="pz-icon icon-back"></i>上一页</span>'),e.page>4){var o=e.page+4;o>e.totalPage&&(o=e.totalPage);var a=o-7;a<1&&(a=1)}else{var a=1,o=8;o>e.totalPage&&(o=e.totalPage)}for(var n=a;n<=o;n++)s+=n==e.page?'<span class="page-current">'+n+"</span>":'<span data-page="'+n+'">'+n+"</span>";e.page<e.totalPage?(s+='<span data-page="'+(e.page+1)+'">下一页<i class="pz-icon icon-more"></i></span>',s+='<span class="page-last" data-page="'+e.totalPage+'">尾页<i class="pz-icon icon-last"></i></span>'):(s+='<span class="page-disabled">下一页<i class="pz-icon icon-more"></i></span>',s+='<span class="page-last page-disabled">尾页<i class="pz-icon icon-last"></i></span>'),t.html(s),e.loadCallback&&e.loadCallback(e),e.callback&&t.find("span").click(function(){var t=$(this).data("page");t&&e.callback(t)})}},pizzaCmd.overlay=function(t,i){this.obj=$('<div class="overlay-content"></div>').append(t),this.overlayObj=$('<div class="pz-overlay" style="display:none;"><div class="overlay"></div></div>'),this.overlayObj.find(".overlay").append(this.obj),$("body").append(this.overlayObj),i&&i(this)},pizzaCmd.overlay.prototype={show:function(){this.overlayObj.css("display","block"),this.obj.css("margin-left",-this.obj.outerWidth()/2)},hide:function(){this.overlayObj.css("display","none")},remove:function(){this.overlayObj.remove()}},pizzaCmd.tooltip=function(t){this.tooltipObj=$('<div class="pz-tooltip fn-hide"><em class="tooltip-arrow"></em><em class="tooltip-arrow tooltip-arrowfill"></em><div class="tooltip-inner"></div></div>'),t&&this.tooltipObj.addClass(t),$("body").append(this.tooltipObj),this.type=""},pizzaCmd.tooltip.prototype={init:function(){var t=this;this.tooltipObj.hover(function(){t.hideTime&&clearTimeout(t.hideTime),t.tooltipObj.removeClass("fn-hide").addClass("tooltip-show")},function(){t.hide()})},show:function(t,i,e){this.hideTime&&clearTimeout(this.hideTime),this.type!=i&&(this.tooltipObj.removeClass("tooltip-"+this.type),this.tooltipObj.addClass("tooltip-"+i),this.type=i),this.objTop=t.position().top,this.objLeft=t.position().left,this.objWidth=t.outerWidth(),this.objHeight=t.outerHeight(),this.tooltipObj.find(".tooltip-inner").html(e),this.tooltipObj.removeClass("fn-hide"),this.setPosition(i)},hide:function(){var t=this;this.tooltipObj.addClass("fn-hide"),this.hideTime=setTimeout(function(){t.tooltipObj.removeClass("tooltip-show")},10)},setPosition:function(t){"top"==t?this.tooltipObj.css({top:this.objTop-this.tooltipObj.outerHeight(),left:this.objLeft+this.objWidth/2-this.tooltipObj.outerWidth()/2}):"bottom"==t?this.tooltipObj.css({top:this.objTop+this.objHeight,left:this.objLeft+this.objWidth/2-this.tooltipObj.outerWidth()/2}):"left"==t?this.tooltipObj.css({top:this.objTop+this.objHeight/2-this.tooltipObj.outerHeight()/2,left:this.objLeft-this.tooltipObj.outerWidth()}):"right"==t&&this.tooltipObj.css({top:this.objTop+this.objHeight/2-this.tooltipObj.outerHeight()/2,left:this.objLeft+this.objWidth}),this.tooltipObj.addClass("tooltip-show")}},pizzaCmd.cutimg=function(t,i){this.cutimgObj=t,this.cutimgConf=i,this.maskObj=this.cutimgObj.find(".j-cutimg-mask"),this.showObj=this.cutimgObj.find(".j-cutimg-show"),this.rangeObj=this.cutimgObj.find(".j-cutimg-range"),this.init()},pizzaCmd.cutimg.prototype={init:function(){if(this.nonsupport=!1,window.FileReader){this.weltLeft=this.shiftSize(this.cutimgConf.padding),this.weltRight=this.shiftSize(this.cutimgConf.padding+this.cutimgConf.width),this.weltTop=this.shiftSize(this.cutimgConf.padding),this.weltBottom=this.shiftSize(this.cutimgConf.padding+this.cutimgConf.height),this.cutimgConf.file&&this.readFile(this.cutimgConf.file),this.maskShow()}else this.nonsupport=!0,this.showObj.html('<div class="fn-pt20 fn-textcenter">该浏览器不支持图片截取功能，<br>建议使用谷歌的Chrome浏览器。</div>')},readFile:function(t){if(t){this.cutimgConf.file=t,this.cutimgObj.find(".actions").removeClass("fn-hide"),this.rangeObj.find("input").val(0);var i=this;newFileReader=new FileReader,newFileReader.onloadend=function(t){function e(){i.orgImgWidth/i.orgImgHeight>i.cutimgConf.width/i.cutimgConf.height?(i.imgKey="height",i.imgMin=i.shiftSize(i.cutimgConf.height),i.imgMax=i.shiftSize(i.orgImgHeight)):(i.imgKey="width",i.imgMin=i.shiftSize(i.cutimgConf.width),i.imgMax=i.shiftSize(i.orgImgWidth)),i.orgImg.css(i.imgKey,i.imgMin).css({position:"absolute",left:i.weltLeft,top:i.weltTop}),i.showObj.html(i.orgImg),"height"==i.imgKey?i.orgImg.css("left",(i.shiftSize(i.cutimgConf.width)-$(s).width())/2+i.weltLeft):i.orgImg.css("top",(i.shiftSize(i.cutimgConf.height)-$(s).height())/2+i.weltTop),i.imgMax>i.imgMin?(i.rangeObj.removeClass("fn-hide"),i.rangeChange()):i.rangeObj.addClass("fn-hide"),i.imgMove()}var s=new Image;i.orgImg=$(s),i.fileResult=t.target.result;var o=!1;s.onload=function(){o||(i.orgImgWidth=s.width,i.orgImgHeight=s.height,o=!0,e())},s.src=i.fileResult},0==t.type.indexOf("image/")?newFileReader.readAsDataURL(t):(this.nonsupport=!0,alert("读取图片信息失败，请使用其他图片文件。"))}else this.showObj.html(""),this.rangeObj.addClass("fn-hide"),this.cutimgObj.find(".actions").addClass("fn-hide")},shiftSize:function(t){return t*this.cutimgConf.scale},maskShow:function(){var t=this.maskObj[0],i=t.getContext("2d");i.fillStyle="rgba(0,0,0,0.7)",i.fillRect(0,0,this.cutimgConf.width+2*this.cutimgConf.padding,this.cutimgConf.height+2*this.cutimgConf.padding),i.clearRect(this.cutimgConf.padding,this.cutimgConf.padding,this.cutimgConf.width,this.cutimgConf.height),i.strokeStyle="#fff",this.cutimgConf.scale<1&&(i.lineWidth=1/this.cutimgConf.scale),i.strokeRect(this.cutimgConf.padding,this.cutimgConf.padding,this.cutimgConf.width,this.cutimgConf.height)},rangeChange:function(){var t=this;this.rangeMove=!1,this.rangeObj.find("input").on("mousedown",function(i){t.rangeMove=!0}).on("mousemove",function(i){if(t.rangeMove){var e=t.imgMin+(t.imgMax-t.imgMin)*$(this).val();t.orgImg.css(t.imgKey,e),t.setWelt()}}).on("mouseup mouseout",function(){t.rangeMove&&(t.rangeMove=!1)}).on("change",function(){var i=t.imgMin+(t.imgMax-t.imgMin)*$(this).val();t.orgImg.css(t.imgKey,i),t.setWelt(),t.rangeMove=!1})},imgMove:function(){var t=this;this.orgImgMove=!1,this.orgImgX=0,this.orgImgY=0,this.orgImgLeft=0,this.orgImgTop=0,this.maskObj.on("mousedown",function(i){return t.orgImgMove=!0,t.orgImgLeft=parseInt(t.orgImg.css("left")),t.orgImgTop=parseInt(t.orgImg.css("top")),t.orgImgX=i.pageX,t.orgImgY=i.pageY,!1}).on("mousemove",function(i){if(t.orgImgMove){var e=t.orgImgLeft+i.pageX-t.orgImgX,s=t.orgImgTop+i.pageY-t.orgImgY;t.orgImg.css({left:e,top:s}),t.setWelt()}return!1}).on("mouseup mouseout",function(){return t.orgImgMove&&(t.orgImgMove=!1),!1})},setWelt:function(){var t=parseInt(this.orgImg.css("left")),i=parseInt(this.orgImg.css("top")),e=this.orgImg.width(),s=this.orgImg.height();t>this.weltLeft?this.orgImg.css("left",this.weltLeft):t+e<this.weltLeft+this.shiftSize(this.cutimgConf.width)&&this.orgImg.css("left",this.weltLeft+this.shiftSize(this.cutimgConf.width)-e),i>this.weltTop?this.orgImg.css("top",this.weltTop):i+s<this.weltTop+this.shiftSize(this.cutimgConf.height)&&this.orgImg.css("top",this.weltTop+this.shiftSize(this.cutimgConf.height)-s)},save:function(){if(this.nonsupport)return!1;if(this.cutimgObj.find(".j-cutimg-original")[0].checked)return this.fileResult;var t=(this.weltLeft-parseInt(this.orgImg.css("left")))*this.orgImgWidth/this.orgImg.width(),i=(this.weltLeft-parseInt(this.orgImg.css("left"))+this.shiftSize(this.cutimgConf.width))*this.orgImgWidth/this.orgImg.width(),e=(this.weltTop-parseInt(this.orgImg.css("top")))*this.orgImgHeight/this.orgImg.height(),s=(this.weltTop-parseInt(this.orgImg.css("top"))+this.shiftSize(this.cutimgConf.height))*this.orgImgHeight/this.orgImg.height(),o=document.createElement("canvas");return o.width=this.cutimgConf.width,o.height=this.cutimgConf.height,imgCanvasCtx=o.getContext("2d"),imgCanvasCtx.drawImage(this.orgImg[0],t,e,i-t,s-e,0,0,this.cutimgConf.width,this.cutimgConf.height),o.toDataURL("image/png")}};